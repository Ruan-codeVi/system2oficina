{"ast":null,"code":"import _regeneratorRuntime from\"/home/juan/\\xC1rea de Trabalho/backup de projeto React/oficina/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _objectSpread from\"/home/juan/\\xC1rea de Trabalho/backup de projeto React/oficina/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _asyncToGenerator from\"/home/juan/\\xC1rea de Trabalho/backup de projeto React/oficina/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/juan/\\xC1rea de Trabalho/backup de projeto React/oficina/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import'./profile.css';import{toast}from'react-toastify';import avatarDefaul from'../../assets/avatar.png';import{FiSettings,FiUpload}from'react-icons/fi';import Header from'../../components/Header';import Title from'../../components/Title';import{useState,useContext}from'react';import{AuthContext}from'../../contexts/auth';import firebase from'../../services/firebaseConnection';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function Profile(){// Context\nvar _useContext=useContext(AuthContext),user=_useContext.user,deslogarFirebase=_useContext.deslogarFirebase,setUser=_useContext.setUser,saveStorageUser=_useContext.saveStorageUser;// Estados\nvar _useState=useState(user&&user.nome),_useState2=_slicedToArray(_useState,2),nome=_useState2[0],setNome=_useState2[1];var _useState3=useState(user&&user.email),_useState4=_slicedToArray(_useState3,2),email=_useState4[0],setEmail=_useState4[1];var _useState5=useState(user&&user.avatarUrl),_useState6=_slicedToArray(_useState5,2),avatarUrl=_useState6[0],setAvatarUrl=_useState6[1];// Para quando o usuario enviar a foto, salvar em um state separada\nvar _useState7=useState(null),_useState8=_slicedToArray(_useState7,2),imageEnvi=_useState8[0],setImageEnvi=_useState8[1];// Função para previous da imagem de avatar antes do submit\nfunction handlePreviousImage(e){if(e.target.files[0]){// Selecionou alguma imagem?\nvar image=e.target.files[0];if(image.type==='image/jpeg'||image.type==='image/jpg'||image.type==='image/png'||image.type==='image/gif'){setImageEnvi(image);setAvatarUrl(URL.createObjectURL(e.target.files[0]));//Criando o previous\n}else{alert('Envie imagem dos tipos: JPEG/JPG/PNG ou GIF');setImageEnvi(null);return null;}}}//Upload de imagem no firabase store\nfunction handleUploadImage(){return _handleUploadImage.apply(this,arguments);}// chama quando alterou algo no profile e clica em salvar\nfunction _handleUploadImage(){_handleUploadImage=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var atualUid;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:atualUid=user.uid;_context3.next=3;return firebase.storage().ref(\"images/\".concat(atualUid,\"/\").concat(imageEnvi.name)).put(imageEnvi).then(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:toast.success('Avatar enviado com sucesso!');console.log('Foto enviada com sucesso');//  Pegando a Url da foto enviada para relacionar no firestone\n_context2.next=4;return firebase.storage().ref(\"images/\".concat(atualUid)).child(imageEnvi.name).getDownloadURL()//  Caso consiga pegar a Url da foto\n.then(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(url){var urlFoto;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:urlFoto=url;_context.next=3;return firebase.firestore().collection('users').doc(user.uid).update({avatarUrl:urlFoto,nome:nome}).then(function(){// obj pega tudo em state user e coloca mais duas props\nvar data=_objectSpread(_objectSpread({},user),{},{avatarUrl:urlFoto,nome:nome});setUser(data);saveStorageUser(data);});case 3:case\"end\":return _context.stop();}}},_callee);}));return function(_x2){return _ref2.apply(this,arguments);};}());case 4:case\"end\":return _context2.stop();}}},_callee2);})));case 3:case\"end\":return _context3.stop();}}},_callee3);}));return _handleUploadImage.apply(this,arguments);}function handleSave(_x){return _handleSave.apply(this,arguments);}function _handleSave(){_handleSave=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(e){return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:e.preventDefault();// Para caso queira mudar só o nome\nif(!(imageEnvi===null&&nome!=='')){_context4.next=6;break;}_context4.next=4;return firebase.firestore().collection('users').doc(user.uid).update({nome:nome}).then(function(){// Refletindo o update para o context\nvar data=_objectSpread(_objectSpread({},user),{},{// pegando tudo que ja tem em user\nnome:nome// Passando o nome digitado para esse obj\n});setUser(data);saveStorageUser(data);toast.success('Nome alterado com sucesso!');}).catch(function(erro){console.log(erro);toast.error('Erro ao tentar troca nome, tente mais tarde');});case 4:_context4.next=7;break;case 6://Para caso queira mudar só foto\nif(nome!==''&&imageEnvi!==null){handleUploadImage();}case 7:case\"end\":return _context4.stop();}}},_callee4);}));return _handleSave.apply(this,arguments);}return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Header,{}),/*#__PURE__*/_jsxs(\"div\",{className:\"content\",children:[/*#__PURE__*/_jsx(Title,{name:\"Meu perfil\",children:/*#__PURE__*/_jsx(FiSettings,{size:25})}),/*#__PURE__*/_jsx(\"div\",{className:\"container\",children:/*#__PURE__*/_jsxs(\"form\",{className:\"form-profile\",onSubmit:handleSave,children:[/*#__PURE__*/_jsxs(\"label\",{className:\"label-avatar\",children:[/*#__PURE__*/_jsx(\"span\",{children:/*#__PURE__*/_jsx(FiUpload,{color:\"#FFF\",size:25})}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",accept:\"image/*\",onChange:handlePreviousImage}),/*#__PURE__*/_jsx(\"br\",{}),avatarUrl===null?/*#__PURE__*/_jsx(\"img\",{src:avatarDefaul,width:\"250\",height:\"250\",alt:\"Foto de perfil padr\\xE3o\"}):/*#__PURE__*/_jsx(\"img\",{src:avatarUrl,width:\"250\",height:\"250\",alt:\"Foto de perfil padr\\xE3o\"})]}),/*#__PURE__*/_jsx(\"label\",{className:\"title\",children:\"Usu\\xE1rio Logado:\"}),/*#__PURE__*/_jsx(\"label\",{children:\"Nome\"}),/*#__PURE__*/_jsx(\"input\",{className:\"profile\",type:\"text\",value:nome,onChange:function onChange(e){return setNome(e.target.value);}}),/*#__PURE__*/_jsx(\"label\",{children:\"E-Mail\"}),/*#__PURE__*/_jsx(\"input\",{className:\"profile\",type:\"text\",value:email,disabled:true,onChange:function onChange(){return setEmail();}}),/*#__PURE__*/_jsx(\"button\",{className:\"btn-salvar\",type:\"submit\",children:\"Salvar\"})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"container\",children:/*#__PURE__*/_jsx(\"button\",{className:\"logout-btn\",onClick:function onClick(){return deslogarFirebase();},children:\"Sair\"})})]})]});}","map":{"version":3,"sources":["/home/juan/Área de Trabalho/backup de projeto React/oficina/src/pages/Profile/index.js"],"names":["toast","avatarDefaul","FiSettings","FiUpload","Header","Title","useState","useContext","AuthContext","firebase","Profile","user","deslogarFirebase","setUser","saveStorageUser","nome","setNome","email","setEmail","avatarUrl","setAvatarUrl","imageEnvi","setImageEnvi","handlePreviousImage","e","target","files","image","type","URL","createObjectURL","alert","handleUploadImage","atualUid","uid","storage","ref","name","put","then","success","console","log","child","getDownloadURL","url","urlFoto","firestore","collection","doc","update","data","handleSave","preventDefault","catch","erro","error","value"],"mappings":"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","sourcesContent":["import './profile.css'\nimport {toast} from 'react-toastify'\nimport avatarDefaul from '../../assets/avatar.png'\nimport {FiSettings, FiUpload} from 'react-icons/fi'\nimport Header from '../../components/Header'\nimport Title from '../../components/Title'\nimport { useState, useContext } from 'react'\nimport { AuthContext } from '../../contexts/auth'\nimport firebase from '../../services/firebaseConnection'\n\n\n\n\nexport default function Profile() {\n  // Context\n  const { user, deslogarFirebase, setUser, saveStorageUser } = useContext( AuthContext )\n  // Estados\n  const [nome, setNome] = useState(user && user.nome)\n  const [email, setEmail] = useState(user && user.email)\n  const [avatarUrl, setAvatarUrl] = useState( user && user.avatarUrl )\n  // Para quando o usuario enviar a foto, salvar em um state separada\n  const [imageEnvi, setImageEnvi] = useState(null)\n  \n// Função para previous da imagem de avatar antes do submit\n  function handlePreviousImage(e) {\n\n    if ( e.target.files[0] ) { // Selecionou alguma imagem?\n      const image = e.target.files[0]\n      \n      if ( image.type === 'image/jpeg' || image.type === 'image/jpg'\n        || image.type === 'image/png' || image.type === 'image/gif' ) {\n        \n        setImageEnvi( image )\n        setAvatarUrl(URL.createObjectURL(e.target.files[0])) //Criando o previous\n      } else {\n        alert('Envie imagem dos tipos: JPEG/JPG/PNG ou GIF')\n        setImageEnvi(null)\n        return null\n      }\n    }\n  \n  }\n\n\n\n  //Upload de imagem no firabase store\n async function handleUploadImage() {\n  const atualUid = user.uid\n   \n  await firebase.storage()\n   .ref( `images/${atualUid}/${imageEnvi.name}` )\n   .put( imageEnvi )\n     .then( async () => {\n       toast.success('Avatar enviado com sucesso!')\n       console.log( 'Foto enviada com sucesso' );\n\n      //  Pegando a Url da foto enviada para relacionar no firestone\n       await firebase.storage().ref( `images/${atualUid}` )\n      .child( imageEnvi.name ).getDownloadURL()\n        //  Caso consiga pegar a Url da foto\n         .then( async ( url ) => {\n           let urlFoto = url;\n\n           await firebase.firestore().collection( 'users' )\n           .doc( user.uid )\n             .update( {\n               avatarUrl: urlFoto,\n               nome: nome\n             } )\n             .then( () => { // obj pega tudo em state user e coloca mais duas props\n               let data = {\n                 ...user,\n                 avatarUrl: urlFoto,\n                 nome:nome\n               }\n               setUser( data )\n               saveStorageUser(data)\n               \n           })\n       })\n   })\n }\n  \n  // chama quando alterou algo no profile e clica em salvar\n  async function handleSave( e ) {\n    e.preventDefault()\n\n    // Para caso queira mudar só o nome\n    if ( imageEnvi === null && nome !== '' ) {\n      // Indo no firab\n      await firebase.firestore().collection( 'users' )\n      .doc( user.uid )\n      .update( {\n        nome: nome\n      } )\n        .then( () => {\n          // Refletindo o update para o context\n          let data = {\n            ...user,  // pegando tudo que ja tem em user\n            nome: nome // Passando o nome digitado para esse obj\n          };\n          setUser( data )\n          saveStorageUser( data )\n          toast.success('Nome alterado com sucesso!')\n         } )\n        .catch( ( erro ) => {\n          console.log( erro )\n          toast.error('Erro ao tentar troca nome, tente mais tarde')\n      })\n    } //Para caso queira mudar só foto\n    else if(nome !=='' && imageEnvi !== null ) {\n      handleUploadImage()\n      \n    }\n}\n\n return (\n   <div>\n     <Header />\n     \n     <div className='content'>\n       <Title name='Meu perfil'>\n         <FiSettings size={25}/>\n       </Title>\n       \n\n       <div className='container'>\n         <form className='form-profile' onSubmit={handleSave}>\n           <label className='label-avatar'>\n             <span><FiUpload color='#FFF' size={25} /></span>\n             <input type='file' accept='image/*'onChange={handlePreviousImage} /><br />\n             {avatarUrl === null ?\n               <img src={avatarDefaul} width='250' height='250' alt='Foto de perfil padrão' />\n               : <img src={avatarUrl} width='250' height='250' alt='Foto de perfil padrão'/> \n            }\n           </label>\n            <label className='title'>Usuário Logado:</label>\n           <label>Nome</label>\n           <input className='profile' type='text' value={nome} onChange={(e)=> setNome(e.target.value) }/>\n           <label>E-Mail</label>\n           <input className='profile' type='text' value={email} disabled={true} onChange={()=> setEmail()} />\n           <button className='btn-salvar' type='submit'>Salvar</button>\n        </form>\n       </div>\n\n       <div className='container'>\n            <button className='logout-btn' onClick={()=> deslogarFirebase()}>\n              Sair\n            </button>\n       </div>\n     </div>\n\n   </div>\n );\n}"]},"metadata":{},"sourceType":"module"}